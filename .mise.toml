[tools]
go = "1.23"
"go:github.com/golangci/golangci-lint/cmd/golangci-lint" = "latest"
"go:mvdan.cc/gofumpt" = "latest"
yamllint = "latest"
yamlfmt = "latest"

[tasks."compile"]
run = """
set -ex

VERSION=$(git tag --sort=-creatordate | head -n 1)
[ -z "$VERSION" ] && VERSION="dev-build"

go build -ldflags "-s -w -X main.version="$VERSION"" -o ./.bin/
"""

[tasks."check:format"]
run = """
#!/usr/bin/env sh

set -ex

gofumpt -d -e -l -extra .
yamlfmt -dry -lint $(find . -name '*.yaml')
"""

[tasks."check:lint"]
run = """
#!/usr/bin/env sh

set -ex

golangci-lint run --timeout 5m --show-stats
yamllint $(find . -name '*.yaml')
"""
